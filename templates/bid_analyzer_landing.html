<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bid Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-gray-50 text-gray-800">
    <div class="flex h-screen">
        {% include 'sidebar.html' %}

        <main class="flex-1 p-8 overflow-y-auto">
            <header class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-gray-900">BID Analyzer</h2>
                <div class="flex items-center">
                    <div class="relative mr-4">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="text" placeholder="Search..."
                            class="bg-white border border-gray-300 rounded-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button class="mr-4 p-2 rounded-full hover:bg-gray-200"><i class="fas fa-bell"></i></button>
                    <div class="flex items-center mr-4"><img src="https://placehold.co/40x40/4338ca/ffffff?text=U"
                            alt="User Avatar" class="rounded-full w-10 h-10"></div>
                </div>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Row 1: Total Bids, Bids GO, Bids Submitted -->
                <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Total Bids</p>
                        <p class="text-3xl font-bold text-gray-900">{{ bid_cards.total_bids }}</p>
                    </div>
                    <i class="fas fa-file-alt text-4xl text-blue-500"></i>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Bids GO</p>
                        <p class="text-3xl font-bold text-green-600">{{ bid_cards.bids_go }}</p>
                    </div>
                    <i class="fas fa-signal text-4xl text-green-500"></i>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Bids Submitted</p>
                        <p class="text-3xl font-bold text-blue-600">{{ bid_cards.bids_submitted }}</p>
                    </div>
                    <i class="fas fa-paper-plane text-4xl text-blue-500"></i>
                </div>

                <!-- Row 2: Bids NO-GO, Bids Lost, Bids Won -->
                <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Bids NO-GO</p>
                        <p class="text-3xl font-bold text-red-600">{{ bid_cards.bids_no_go }}</p>
                    </div>
                    <i class="fas fa-ban text-4xl text-red-500"></i>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Bids Lost</p>
                        <p class="text-3xl font-bold text-gray-600">{{ bid_cards.bids_lost }}</p>
                    </div>
                    <i class="fas fa-times-circle text-4xl text-gray-500"></i>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Bids Won</p>
                        <p class="text-3xl font-bold text-green-600">{{ bid_cards.bids_won }}</p>
                    </div>
                    <i class="fas fa-trophy text-4xl text-green-500"></i>
                </div>
            </div>

            <!-- RFP Analyzer Tools -->
            <div class="grid grid-cols-8 md:grid-cols-1  mb-8">
                <div class="bg-gradient-to-r from-purple-500 to-indigo-600 p-6 rounded-lg shadow-lg text-white">
                    <div class="flex items-center mb-4" style="width: 100%;display: flex;flex-direction: row;gap: 6;">
                        <i class="fas fa-robot text-4xl mr-4"></i>
                        <div style="width: 100%;">
                            <div style="width: 100%;display: flex;align-items: center;justify-content: space-between;gap: 12px;">
                                <div>
                                    <h3 class="text-2xl font-bold">AI RFP Analyzer</h3>
                                    <p class="text-purple-100 text-sm">Advanced AI BID Evaluation</p>
                                </div>
                                <a href="https://bidanalyzer-cjfnh4ascpudkmagvve8z5.streamlit.app/" target="_blank" rel="noopener"
                        class="inline-block px-6 py-3 bg-white text-purple-600 font-semibold rounded-lg hover:bg-purple-50 transition duration-200">
                        Open AI Analyzer   <i class="fas fa-arrow-right mr-2"></i>
                    </a>
                            </div>
                        </div>
                    </div>
                    <p class="mb-4 text-purple-100">An advanced AI-based compliance assessment system featuring multi-company comparison and automated scoring capabilities.</p>
                    
                </div>

            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">DATABASE (BID INCOMING)</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="sticky top-0 bg-white">
                            <tr class="border-b">
                                <th class="p-2">ID</th>
                                <th class="p-2">Bid Name</th>
                                <th class="p-2">In Date</th>
                                <th class="p-2">Due Date</th>
                                <th class="p-2">State</th>
                                <th class="p-2">Scope</th>
                                <th class="p-2">Type</th>
                                <th class="p-2">Scoring</th>
                                <th class="p-2">Company</th>
                                <th class="p-2">Decision</th>
                                <th class="p-2">Summary</th>
                                <th class="p-2">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for bid in bid_incoming_data %}
                            <tr class="border-b border-gray-200">
                                <td class="p-2">{{ bid.b_id }}</td>
                                <td class="p-2">{{ bid.b_name or '-' }}</td>
                                <td class="p-2">{{ bid.in_date or '-' }}</td>
                                <td class="p-2">{{ bid.due_date or '-' }}</td>
                                <td class="p-2">{{ bid.state or '-' }}</td>
                                <td class="p-2 max-w-xs truncate">{{ bid.scope or '-' }}</td>
                                <td class="p-2">{{ bid.type or '-' }}</td>
                                <td class="p-2">{{ bid.scoring or '-' }}</td>
                                <td class="p-2">{{ bid.comp_name or '-' }}</td>
                                <td class="p-2">
                                    <span class="px-2 py-1 rounded text-xs font-medium
                                        {% if bid.decision == 'GO' %}bg-green-100 text-green-800
                                        {% elif bid.decision == 'NO-GO' %}bg-red-100 text-red-800
                                        {% elif bid.decision == 'WON' %}bg-blue-100 text-blue-800
                                        {% elif bid.decision == 'LOST' %}bg-gray-100 text-gray-800
                                        {% else %}bg-gray-100 text-gray-600{% endif %}">
                                        {{ bid.decision or '-' }}
                                    </span>
                                </td>
                                <td class="p-2 max-w-xs truncate">{{ bid.summary or '-' }}</td>
                                <td class="p-2">
                                    <button onclick="openUpdateModal({{ bid.b_id }})"
                                        class="text-blue-600 hover:text-blue-800 mr-2" data-bid-id="{{ bid.b_id }}"
                                        data-bid-name="{{ bid.b_name or '' }}"
                                        data-in-date="{{ bid.in_date.strftime('%Y-%m-%d') if bid.in_date else '' }}"
                                        data-due-date="{{ bid.due_date.strftime('%Y-%m-%d') if bid.due_date else '' }}"
                                        data-state="{{ bid.state or '' }}" data-scope="{{ bid.scope or '' }}"
                                        data-type="{{ bid.type or '' }}" data-scoring="{{ bid.scoring or '' }}"
                                        data-comp-name="{{ bid.comp_name or '' }}"
                                        data-decision="{{ bid.decision or '' }}" data-summary="{{ bid.summary or '' }}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <a href="{{ url_for('delete_bid_incoming', bid_id=bid.b_id) }}"
                                        onclick="return confirm('Are you sure you want to delete this bid?')"
                                        class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Create Button -->
                <div class="mt-6 flex justify-end">
                    <button onclick="openCreateModal()"
                        class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg">
                        <i class="fas fa-plus mr-2"></i>Create New Bid
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Create Modal -->
    <div id="createModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Create New Bid</h3>
                    <form action="{{ url_for('create_bid_incoming') }}" method="POST">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Bid Name *</label>
                                <input type="text" name="b_name" required
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Incoming Date *</label>
                                <input type="date" name="in_date" required
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Due Date *</label>
                                <input type="date" name="due_date" required
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">State</label>
                                <select name="state"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select State</option>
                                    <option value="pending">Pending</option>
                                    <option value="submitted">Submitted</option>
                                    <option value="under_review">Under Review</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <input type="text" name="type"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Scoring</label>
                                <input type="number" name="scoring" min="0" max="100"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                                <input type="text" name="comp_name"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Decision</label>
                                <select name="decision"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Decision</option>
                                    <option value="GO">GO</option>
                                    <option value="NO-GO">NO-GO</option>
                                    <option value="WON">WON</option>
                                    <option value="LOST">LOST</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Scope</label>
                                <textarea name="scope" rows="3"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Summary</label>
                                <textarea name="summary" rows="3"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-4 mt-6">
                            <button type="button" onclick="closeCreateModal()"
                                class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg">Cancel</button>
                            <button type="submit"
                                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg">Create
                                Bid</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Modal -->
    <div id="updateModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Update Bid</h3>
                    <form id="updateForm" method="POST">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Bid Name *</label>
                                <input type="text" name="b_name" id="update_b_name" required
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Incoming Date *</label>
                                <input type="date" name="in_date" id="update_in_date" required
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Due Date *</label>
                                <input type="date" name="due_date" id="update_due_date" required
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">State</label>
                                <select name="state" id="update_state"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select State</option>
                                    <option value="pending">Pending</option>
                                    <option value="submitted">Submitted</option>
                                    <option value="under_review">Under Review</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <input type="text" name="type" id="update_type"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Scoring</label>
                                <input type="number" name="scoring" id="update_scoring" min="0" max="100"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Company Name</label>
                                <input type="text" name="comp_name" id="update_comp_name"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Decision</label>
                                <select name="decision" id="update_decision"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Decision</option>
                                    <option value="GO">GO</option>
                                    <option value="NO-GO">NO-GO</option>
                                    <option value="WON">WON</option>
                                    <option value="LOST">LOST</option>
                                </select>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Scope</label>
                                <textarea name="scope" id="update_scope" rows="3"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Summary</label>
                                <textarea name="summary" id="update_summary" rows="3"
                                    class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-4 mt-6">
                            <button type="button" onclick="closeUpdateModal()"
                                class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg">Cancel</button>
                            <button type="submit"
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">Update
                                Bid</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Modal functions
        function openCreateModal() {
            document.getElementById('createModal').classList.remove('hidden');
        }

        function closeCreateModal() {
            document.getElementById('createModal').classList.add('hidden');
        }

        function openUpdateModal(bidId) {
            // Find the button that was clicked to get the data attributes
            const button = event.target.closest('button');

            if (bidId && button) {
                // Update existing bid - populate form with existing data
                document.getElementById('updateForm').action = `/bid-analyzer/update/${bidId}`;
                document.getElementById('update_b_name').value = button.getAttribute('data-bid-name') || '';
                document.getElementById('update_in_date').value = button.getAttribute('data-in-date') || '';
                document.getElementById('update_due_date').value = button.getAttribute('data-due-date') || '';
                document.getElementById('update_state').value = button.getAttribute('data-state') || '';
                document.getElementById('update_scope').value = button.getAttribute('data-scope') || '';
                document.getElementById('update_type').value = button.getAttribute('data-type') || '';
                document.getElementById('update_scoring').value = button.getAttribute('data-scoring') || '';
                document.getElementById('update_comp_name').value = button.getAttribute('data-comp-name') || '';
                document.getElementById('update_decision').value = button.getAttribute('data-decision') || '';
                document.getElementById('update_summary').value = button.getAttribute('data-summary') || '';
            } else {
                // Create new bid (not used in this context)
                document.getElementById('updateForm').action = '/bid-analyzer/create';
                document.getElementById('updateForm').reset();
            }
            document.getElementById('updateModal').classList.remove('hidden');
        }

        function closeUpdateModal() {
            document.getElementById('updateModal').classList.add('hidden');
        }


        // Close modals when clicking outside
        window.onclick = function (event) {
            const createModal = document.getElementById('createModal');
            const updateModal = document.getElementById('updateModal');
            if (event.target === createModal) {
                closeCreateModal();
            }
            if (event.target === updateModal) {
                closeUpdateModal();
            }
        }
    </script>
</body>

</html>